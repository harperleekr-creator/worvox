# 🎯 PHASE 1 요약 - "대화 → 피드백 체감"

## 📌 한 줄 요약
**"10분 안에 사용자가 '이 앱은 나를 분석한다'고 느끼게 만들기"**

---

## ✅ 현재 상태

### 이미 있는 것들 (좋은 소식!)
- ✅ Session ID 저장 시스템
- ✅ 사용자 발화 로그 (`messages` 테이블)
- ✅ AI 응답 로그
- ✅ 음성 전사(transcription) 저장
- ✅ 대화 히스토리 페이지

### 없는 것들 (만들어야 할 것)
- ❌ 자동 코칭 리포트
- ❌ 문장별 오류 분석
- ❌ 마이크로 드릴 (문장 다시 연습)
- ❌ 세션 종료 시 자동 분석

---

## 🎯 목표 플로우

```
사용자가 대화 시작
      ↓
5-10개 메시지 교환
      ↓
[End Session] 버튼 클릭
      ↓
⏳ "AI가 분석 중..." (10-20초)
      ↓
🎉 리포트 화면 등장!
      ↓
1. 총점: 75/100
2. 고쳐야 할 문장 3개 ⚠️
3. 더 나은 표현 2개 💡
4. [이 문장 다시 연습하기] 버튼
      ↓
클릭하면 → 문장 따라 말하기
      ↓
✅ "체감 완료!"
```

---

## 🛠 구현 할 일 (6-7시간)

### 1️⃣ 데이터베이스 (30분)
**새 테이블 2개 추가**
- `session_reports`: 점수, 통계 저장
- `session_feedback`: 오류 및 개선 제안 저장

```sql
migrations/0015_add_session_analysis.sql
```

### 2️⃣ 백엔드 API (2시간)
**새 라우트: `src/routes/analysis.ts`**
- `POST /api/analysis/sessions/:sessionId/analyze`
  - GPT-4로 대화 분석
  - 점수 계산 (0-100)
  - 에러 3개, 개선안 2개 추출
  - DB에 저장
- `GET /api/analysis/reports/:reportId`
  - 리포트 조회
- `POST /api/analysis/feedback/:feedbackId/practice`
  - 연습 완료 표시

### 3️⃣ 프론트엔드 (3-4시간)
**수정할 파일: `public/static/app.js`**

1. `endSession()` 함수 수정
   - 세션 종료 시 자동으로 분석 API 호출
   - 메시지 3개 이상일 때만 분석

2. 새 함수 3개 추가
   - `showAnalysisLoading()`: 분석 중 로딩 화면
   - `showSessionReport()`: 리포트 페이지 (핵심!)
   - `practiceSentence()`: 문장 연습 드릴

3. History 페이지에 "리포트 보기" 버튼 추가

---

## 🎨 UI 미리보기

### 리포트 화면 구성
```
┌─────────────────────────────────────┐
│         🎉 대화 분석 완료!           │
│   AI가 당신의 대화를 분석했어요      │
├─────────────────────────────────────┤
│ [종합 75] [문법 70] [어휘 80] [유창성 75] │
├─────────────────────────────────────┤
│ ⚠️ 고쳐야 할 문장 TOP 3              │
│                                     │
│ #1 [문법] 우선순위 ⭐⭐⭐          │
│ ❌ I go to school yesterday         │
│ ✅ I went to school yesterday       │
│ 💡 과거 시제를 사용해야 해요         │
│ [🔄 이 문장 다시 연습하기]           │
│                                     │
│ (2개 더...)                         │
├─────────────────────────────────────┤
│ 💡 더 나은 표현                      │
│                                     │
│ #1 [어휘]                           │
│ 😊 I think it's good               │
│ 🌟 I believe it's excellent        │
│ 💡 더 강한 표현으로 바꿔보세요       │
│ [🔄 이 표현 연습하기]                │
│                                     │
│ (1개 더...)                         │
├─────────────────────────────────────┤
│ [🏠 홈으로] [📚 히스토리 보기]       │
└─────────────────────────────────────┘
```

### 연습 화면
```
┌─────────────────────────────────────┐
│         🎯 문장 연습                 │
├─────────────────────────────────────┤
│                                     │
│   I went to school yesterday        │
│                                     │
├─────────────────────────────────────┤
│       [🎤 녹음 시작]                 │
│                                     │
│ 버튼을 눌러 문장을 따라 말해보세요    │
│                                     │
│       [← 리포트로 돌아가기]          │
└─────────────────────────────────────┘
```

---

## 💰 비용 절감 팁

### GPT-4 → GPT-3.5 먼저
- GPT-4: $0.03/1K tokens (비쌈)
- GPT-3.5-turbo: $0.002/1K tokens (10배 저렴)
- **MVP는 3.5로 시작, 추후 업그레이드**

### 분석 캐싱
- 같은 세션 재분석 방지
- DB에 이미 리포트 있으면 스킵

---

## 📊 성공 지표

### 정량적
- [ ] 리포트 생성 성공률 > 95%
- [ ] 분석 시간 < 30초
- [ ] 리포트 오픈 후 연습 클릭률 > 30%

### 정성적
- [ ] 사용자가 "오, 진짜 분석하네!"라고 느낌
- [ ] 10분 안에 피드백 체감
- [ ] 무엇을 공부해야 할지 명확함

---

## 🚀 다음 단계 (PHASE 2)

PHASE 1 완료 후:
1. **드릴 시스템 강화**
   - 발음 유사도 체크
   - 문장 비교 알고리즘
   
2. **진행도 추적**
   - 주간 성장 그래프
   - 취약점 분석
   
3. **동기부여**
   - Streak 시스템
   - 레벨 업
   
4. **결제 연동**
   - Free: 일 3회 분석
   - Premium: 무제한

---

## ⏱ 구현 순서 (권장)

| 단계 | 작업 | 시간 | 누적 |
|------|------|------|------|
| 1 | DB 스키마 추가 | 30분 | 30분 |
| 2 | 분석 API 구현 | 2시간 | 2.5시간 |
| 3 | 리포트 UI | 2시간 | 4.5시간 |
| 4 | endSession 수정 | 30분 | 5시간 |
| 5 | 연습 드릴 | 1시간 | 6시간 |
| 6 | History 연동 | 30분 | 6.5시간 |
| 7 | 테스트 & 디버깅 | 1시간 | 7.5시간 |

**총 예상: 하루 작업량**

---

## 💡 핵심 포인트

### 사용자에게 보여줄 것
1. **즉각성**: 세션 끝나면 바로 분석
2. **구체성**: "문법 틀렸어요" ❌ → "I go를 I went로" ✅
3. **실행 가능성**: [다시 연습하기] 버튼
4. **긍정성**: 점수는 50점 이상, "개선 기회"로 표현

### 기술적 주의사항
1. 분석 중 로딩 화면 필수
2. 분석 실패 시 graceful fallback
3. 짧은 대화(3개 미만)는 분석 스킵
4. GPT-4 프롬프트 신중하게 작성

---

## ✅ 시작 전 체크리스트

- [ ] OpenAI API 키 준비됨
- [ ] D1 데이터베이스 접근 가능
- [ ] 로컬 개발 환경 구동 가능
- [ ] Git 브랜치 생성 (`feature/phase1-analysis`)
- [ ] 백업 완료

---

## 🎉 완료 후 모습

```
사용자: "Wow, 이 앱 진짜 내 영어를 분석하네!"
       "뭘 고쳐야 하는지 정확히 알려줘!"
       "바로 연습할 수 있어서 좋다!"
       "영어 실력 늘 것 같아!"
```

**→ 이게 바로 PHASE 1의 목표입니다! 🚀**
